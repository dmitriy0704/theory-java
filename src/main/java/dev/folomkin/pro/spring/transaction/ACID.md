# ACID

**ACID** — это набор четырёх принципов, которые гарантируют, что транзакции в *
*системах управления базами данных (СУБД)** выполняются корректно и с
сохранением **целостности** данных, даже в случае сбоев или ошибок.

ACID — это аббревиатура, расшифровывается как:

1. **A** — **Atomicity** (Атомарность)
2. **C** — **Consistency** (Согласованность)
3. **I** — **Isolation** (Изоляция)
4. **D** — **Durability** (Долговечность)

Каждый из этих принципов играет важную роль в обеспечении корректной работы
транзакций в базе данных.

### 1. **Atomicity** (Атомарность)

**Атомарность** означает, что транзакция рассматривается как **единое целое**,
которое либо выполняется полностью, либо не выполняется вообще. Если в процессе
выполнения транзакции произошла ошибка, все изменения, сделанные в рамках
транзакции, будут откатаны, и база данных вернется в состояние, которое было до
её начала.

- **Пример**: Если транзакция включает в себя два действия, например, перевод
  денег с одного счёта на другой, и при этом происходит сбой при снятии денег,
  то операция будет отменена, и деньги не будут сняты.

### 2. **Consistency** (Согласованность)

**Согласованность** гарантирует, что транзакция переводит базу данных из одного
**консистентного состояния** в другое, соблюдая все бизнес-правила, ограничения
и инварианты, заданные для данных. Если транзакция завершена успешно, база
данных должна оставаться в консистентном состоянии. В случае сбоя транзакция не
должна приводить к нарушению целостности данных.

- **Пример**: Если в базе данных есть ограничения, например, на уникальность
  идентификаторов или на значения валюты, то транзакция должна быть такой, чтобы
  после её выполнения эти ограничения не нарушались.

### 3. **Isolation** (Изоляция)

**Изоляция** гарантирует, что транзакции выполняются независимо друг от друга, и
их результаты не могут быть видны другим транзакциям до завершения. Это
означает, что одна транзакция не может "увидеть" изменения, сделанные другой
транзакцией, если эта другая транзакция ещё не завершена (в зависимости от
уровня изоляции транзакций).

- **Пример**: Если две транзакции одновременно пытаются изменить один и тот же
  объект, одна из них должна быть заблокирована до завершения другой, чтобы
  избежать конфликтов и несогласованности данных.

### 4. **Durability** (Долговечность)

**Долговечность** гарантирует, что как только транзакция завершена (коммичена),
все её изменения будут сохранены в базе данных и не будут потеряны, даже если
произойдёт сбой системы, например, сбой питания или отключение компьютера.

- **Пример**: После того как вы перевели деньги на счёт другого человека,
  изменения должны остаться в базе данных даже если сервер упадет сразу после
  завершения транзакции.

---

## Свойства транзакций ACID

- **Атомарность (Atomicity)** гарантирует, что никакая транзакция не будет
  зафиксирована в системе частично. Будут либо выполнены все операции, либо ни
  одной.

- **Согласованность (Consistency)**. Выполненая транзакция, сохраняет
  согласованность базы данных. Согласованность является более широким понятием,
  чем может показаться.<br>
  Например, в банковской системе может существовать требование равенства суммы,
  списываемой с одного счёта, сумме, зачисляемой на другой. Это бизнес-правило и
  оно не может быть гарантировано только проверками целостности базы данных. Это
  поведение должны учитывать программисты при написании кода транзакций. Если
  какая-либо транзакция произведёт списание, но не произведёт зачисления, то
  система останется в некорректном состоянии и свойство согласованности будет
  нарушено.

- **Изолированность (Isolation)**. Во время выполнения транзакции параллельные
  транзакции не должны оказывать влияние на её результат.
  Изолированность обходится дорого, поэтому в реальных базах данных существуют
  режимы, не полностью изолирующие транзакцию. Об уровнях изоляции мы поговорим
  в отдельной статье.

- **Устойчивость (Durability)**. Независимо от проблем с оборудованием,
  изменения, сделанные успешно завершённой транзакцией, должны остаться
  сохранёнными после возвращения системы в работу.

Конечно! Свойства **ACID** — это набор ключевых принципов, которые обеспечивают
надежность и корректность транзакций в системах управления базами данных (СУБД)
и других системах, работающих с данными.

### Что такое ACID?

ACID — это аббревиатура из четырёх свойств транзакций:

| Буква | Свойство                      | Описание                                                                                                   |
|-------|-------------------------------|------------------------------------------------------------------------------------------------------------|
| A     | Atomicity (Атомарность)       | Транзакция выполняется полностью или не выполняется вовсе. Нет частичных изменений.                        |
| C     | Consistency (Согласованность) | Транзакция переводит систему из одного корректного состояния в другое, сохраняя все правила и ограничения. |
| I     | Isolation (Изолированность)   | Параллельные транзакции не влияют друг на друга, как если бы они выполнялись последовательно.              |
| D     | Durability (Долговечность)    | После успешного завершения транзакции её изменения сохраняются навсегда, даже при сбоях.                   |

#### Подробнее о каждом свойстве

#### 1. Atomicity (Атомарность)

- Транзакция — это единое целое.
- Все операции внутри транзакции либо выполняются полностью, либо не выполняются
  вовсе.
- Если что-то пошло не так — все изменения откатываются.

**Пример:** перевод денег между счетами: списание с одного и зачисление на
другой — обе операции должны пройти вместе.

#### 2. Consistency (Согласованность)

- После выполнения транзакции база данных остаётся в корректном состоянии.
- Все бизнес-правила, ограничения целостности данных соблюдены.
- Транзакция не нарушает целостность данных.

**Пример:** сумма денег на счетах до и после перевода должна оставаться
неизменной.

#### 3. Isolation (Изолированность)

- Одновременное выполнение нескольких транзакций не должно приводить к
  некорректным результатам.
- Каждая транзакция "изолирована" от других до её завершения.
- В разных СУБД есть разные уровни изоляции (Read Uncommitted, Read Committed,
  Repeatable Read, Serializable).

**Пример:** если одна транзакция читает данные, другая не должна изменять их до
завершения первой.

#### 4. Durability (Долговечность)

- После успешного завершения транзакции её результаты сохраняются навсегда.
- Даже при сбое системы или отключении питания данные не теряются.
- Обычно достигается с помощью журналирования и записи на диск.

#### Итог

ACID гарантирует, что работа с данными будет:

- Надёжной,
- Предсказуемой,
- Безопасной от ошибок и сбоев.

Это фундамент для построения устойчивых систем с базами данных и другими
критичными приложениями.

====



---

## 🧩 Пример работы ACID принципов:

Предположим, у нас есть система, в которой два пользователя пытаются перевести
деньги с одного счёта на другой одновременно:

1. **Atomicity**:

- Если транзакция перевода денег с одного счёта на другой не может быть
  завершена полностью, например, из-за сбоя при списании средств, то все
  изменения, сделанные в процессе, откатываются.
- В случае ошибки данные остаются в том же состоянии, как до начала
  транзакции.

2. **Consistency**:

- Если у нас есть правило, что на счёте не может быть отрицательного
  баланса, то транзакция, которая приводит к нарушению этого правила (
  например, попытка снять больше денег, чем есть на счёте), будет отклонена.
- Это обеспечит сохранение целостности данных.

3. **Isolation**:

- Если два пользователя одновременно пытаются перевести деньги с одного
  счёта на другой, транзакции должны быть выполнены таким образом, чтобы
  изменения одного пользователя не мешали изменениям другого, либо одна из
  транзакций будет ожидать завершения другой.
- В результате, обе транзакции будут выполнены последовательно, или одна из
  них будет откатана, чтобы избежать конфликтов.

4. **Durability**:

- После того как транзакция завершена, переведённые деньги остаются на новом
  счёте, и изменения сохраняются, даже если система внезапно выйдет из
  строя.
- В случае сбоя при выполнении транзакции база данных будет в том состоянии,
  в котором она была до начала транзакции.

---

### 🌍 Применение ACID в реальных системах

1. **Базы данных**: В реляционных базах данных (например, MySQL, PostgreSQL,
   Oracle) принципы ACID обеспечиваются через механизмы управления транзакциями.

2. **Системы, работающие с деньгами**: Например, в банковских системах или
   приложениях для электронной коммерции важно, чтобы транзакции по переводу
   средств между пользователями всегда соблюдали принципы ACID.

3. **Системы с критичной целостностью данных**: Приложения, где важна точность и
   целостность информации, например, в медицинских, юридических и финансовых
   приложениях.

---

### 🔧 Проблемы с ACID

Хотя принципы ACID обеспечивают надежность и целостность данных, они могут *
*снижать производительность** системы. Строгая изоляция между транзакциями и
необходимость блокировать ресурсы могут привести к **потерям производительности
** при высокой нагрузке.

Для таких случаев появились **гибридные подходы** и новые типы баз данных,
например, **NoSQL базы данных**, которые используют более гибкие модели
изоляции (например, **BASE**), подходящие для масштабируемых и распределённых
систем.

---

### 💡 Резюме:

- **ACID** — это четыре принципа (Атомарность, Согласованность, Изоляция и
  Долговечность), которые гарантируют правильное выполнение транзакций в базах
  данных.
- Эти принципы обеспечивают **целостность данных**, **предсказуемость поведения
  ** и **стабильность работы системы**, несмотря на ошибки или сбои.
- Однако из-за требований к блокировкам и изоляции, принципы ACID могут *
  *снижать производительность**, особенно в системах с высокой нагрузкой.

Если интересуют подробности об одном из принципов или примеры их применения,
могу углубиться в конкретную тему!

### Реализация ACID в Spring

Конечно! В Spring Framework поддержка транзакций и обеспечение свойств ACID
реализуются через модуль **Spring Transaction Management**. Рассмотрим, как
Spring помогает реализовать каждое из свойств ACID на практике.

#### 1. Atomicity (Атомарность)

- В Spring атомарность достигается с помощью аннотации `@Transactional`.
- Все операции внутри метода, помеченного `@Transactional`, выполняются как
  единое целое.
- Если в процессе выполнения возникает исключение (например,
  `RuntimeException`), транзакция откатывается — все изменения отменяются.

**Пример:**

```java

@Service
public class BankService {

    @Transactional
    public void transferMoney(Long fromAccountId, Long toAccountId, BigDecimal amount) {
        debit(fromAccountId, amount);
        credit(toAccountId, amount);
        // Если здесь выбросится исключение — изменения откатятся
    }

    private void debit(Long accountId, BigDecimal amount) {
        // списание денег
    }

    private void credit(Long accountId, BigDecimal amount) {
        // зачисление денег
    }
}
```

#### 2. Consistency (Согласованность)

- Spring не проверяет бизнес-правила напрямую, но обеспечивает согласованность
  через интеграцию с СУБД.
- Все ограничения базы данных (например, внешние ключи, уникальные индексы)
  применяются при коммите транзакции.
- Если транзакция нарушает ограничения — она откатывается.

**Пример:**

Если в базе есть ограничение уникальности по email пользователя, попытка
сохранить дубликат вызовет ошибку и откатит транзакцию.

#### 3. Isolation (Изолированность)

- В Spring можно задать уровень изоляции транзакции через параметр `isolation` в
  `@Transactional`.

```java

@Transactional(isolation = Isolation.REPEATABLE_READ)
public void someMethod() {
    // ...
}
```

- Это позволяет контролировать видимость изменений между параллельными
  транзакциями и предотвращать аномалии чтения.

#### 4. Durability (Долговечность)

- Обеспечивается на уровне СУБД и системы хранения.
- Spring гарантирует вызов коммита транзакции после успешного выполнения метода.
- После коммита данные сохраняются в базе и не теряются при сбоях.

## Дополнительно: пример конфигурации

```java

@Configuration
@EnableTransactionManagement
public class AppConfig {

    @Bean
    public PlatformTransactionManager transactionManager(DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}
```

#### Итог

| Свойство ACID | Как реализуется в Spring                       |
|---------------|------------------------------------------------|
| Atomicity     | Аннотация `@Transactional` + откат при ошибках |
| Consistency   | Интеграция с СУБД + ограничения базы данных    |
| Isolation     | Параметр `isolation` в `@Transactional`        |
| Durability    | Коммит транзакции + надёжное хранение данных   |

Если хочешь — могу помочь с примерами настройки уровней изоляции или обработкой
ошибок для управления откатом!

