## Kafka Cluster (–∫–ª–∞—Å—Ç–µ—Ä Kafka)

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! üéØ

---

## üñß –ß—Ç–æ —Ç–∞–∫–æ–µ **Kafka Cluster**?

**Kafka Cluster** ‚Äî —ç—Ç–æ **–≥—Ä—É–ø–ø–∞ –±—Ä–æ–∫–µ—Ä–æ–≤**, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ, —á—Ç–æ–±—ã:

- üì¶ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç **producers**,
- üì§ –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∏—Ö **consumers**,
- üîÑ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.

---

### üìö –ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è:

> Kafka –∫–ª–∞—Å—Ç–µ—Ä ‚Äî —ç—Ç–æ –Ω–µ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä, –∞ **–º–Ω–æ–∂–µ—Å—Ç–≤–æ Kafka-–±—Ä–æ–∫–µ—Ä–æ–≤**,
> —Å–æ–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–µ –∏ –∑–Ω–∞—é—â–∏—Ö –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ.

---

## üë• –ü—Ä–∏–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞

–î–æ–ø—É—Å—Ç–∏–º, —É —Ç–µ–±—è 3 –±—Ä–æ–∫–µ—Ä–∞:

```
kafka-1:9092
kafka-2:9092
kafka-3:9092
```

–≠—Ç–æ –∏ –µ—Å—Ç—å **Kafka Cluster** –∏–∑ 3 —É–∑–ª–æ–≤.

---

## üß† –ö–∞–∫ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

### üîÅ 1. –ü–∞—Ä—Ç–∏—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –±—Ä–æ–∫–µ—Ä–∞–º–∏:

- –ö–∞–∂–¥—ã–π —Ç–æ–ø–∏–∫ —Ä–∞–∑–±–∏—Ç –Ω–∞ **–ø–∞—Ä—Ç–∏—Ü–∏–∏**.
- –≠—Ç–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –±—Ä–æ–∫–µ—Ä–∞—Ö.

### üõ° 2. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è:

- Kafka –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –æ–¥–Ω–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞ –Ω–∞ –¥—Ä—É–≥–æ–π (–¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏).

### üß† 3. –û–¥–∏–Ω –∏–∑ –±—Ä–æ–∫–µ—Ä–æ–≤ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º –∫–ª–∞—Å—Ç–µ—Ä–∞**:

- –û–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–∞—Ä—Ç–∏—Ü–∏–π –∏ —Å–ª–µ–¥–∏—Ç –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
  –¥—Ä—É–≥–∏—Ö –±—Ä–æ–∫–µ—Ä–æ–≤.

---

## üìä –ü—Ä–∏–º–µ—Ä:

–¢–æ–ø–∏–∫ `user-events` —Å 6 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –∏–∑ 3 –±—Ä–æ–∫–µ—Ä–æ–≤:

| Partition | Leader | Replicas |
|-----------|--------|----------|
| 0         | B1     | B1, B2   |
| 1         | B2     | B2, B3   |
| 2         | B3     | B3, B1   |
| 3         | B1     | B1, B3   |
| 4         | B2     | B2, B1   |
| 5         | B3     | B3, B2   |

---

## ‚öôÔ∏è –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka:

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å           | –û–ø–∏—Å–∞–Ω–∏–µ                                        |
|-----------------------|-------------------------------------------------|
| üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å   | –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –±—Ä–æ–∫–µ—Ä—ã –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É |
| üîê –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å         | –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –±—Ä–æ–∫–µ—Ä–∞–º–∏                      |
| üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π                |
| üîÅ –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–ø–ª–∏–∫—É –ø—Ä–∏ —Å–±–æ–µ –ª–∏–¥–µ—Ä–∞         |

---

## üß™ –ú–∏–Ω–∏-–∫–ª–∞—Å—Ç–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∞: `docker-compose`

```yaml
version: '3'
services:
  zookeeper:
    image: confluentinc/cp-zookeeper
    ...
  kafka-1:
    image: confluentinc/cp-kafka
    ...
  kafka-2:
    image: confluentinc/cp-kafka
    ...
```

---

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–∞ 3 –±—Ä–æ–∫–µ—Ä–∞? –ò–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫
–≤—ã–≥–ª—è–¥–∏—Ç failover? –ü–∏—à–∏ ‚Äî —Å–æ–±–µ—Ä—ë–º üîß
