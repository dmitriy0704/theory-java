### 8. Kraft

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! üöÄ

---

## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ **KRaft** –≤ Kafka?

**KRaft** (Kafka Raft Metadata mode) ‚Äî —ç—Ç–æ **–Ω–æ–≤—ã–π —Å–ø–æ—Å–æ–± —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
–≤ Apache Kafka**, –∫–æ—Ç–æ—Ä—ã–π **–∑–∞–º–µ–Ω—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ ZooKeeper**.

> –†–∞–Ω—å—à–µ Kafka –∑–∞–≤–∏—Å–µ–ª–∞ –æ—Ç **ZooKeeper** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—Ä–æ–∫–µ—Ä–∞—Ö,
> —Ç–æ–ø–∏–∫–∞—Ö, ACL –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

**KRaft** –¥–µ–ª–∞–µ—Ç Kafka **—Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π**: —Ç–µ–ø–µ—Ä—å –≤—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏
—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ —Å–∞–º–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka**, –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ ZooKeeper.

---

## üìú KRaft —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:

- **K**afka
- **Raft** ‚Äî —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏.

---

## üî• –ü–æ—á–µ–º—É Kafka —É—à–ª–∞ –æ—Ç ZooKeeper?

| –ë—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞                              | KRaft —Ä–µ—à–∞–µ—Ç                                    |
|--------------------------------------------|-------------------------------------------------|
| üé≠ –°–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Kafka + ZooKeeper) | üì¶ –í—Å—ë –≤ –æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ Kafka                    |
| üîÑ –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è          | ‚ö° –ë—ã—Å—Ç—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Raft              |
| üî• –ú–Ω–æ–≥–æ —Ä—É—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ ZooKeeper         | üîß –ü—Ä–æ—â–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å Kafka |
| üõ° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö          | üõ° –ß–∏—Å—Ç–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Raft-–ø—Ä–æ—Ç–æ–∫–æ–ª   |

---

## üõ† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä KRaft?

- –ï—Å—Ç—å **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã** (KRaft controllers) ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±—Ä–æ–∫–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ
  —É–ø—Ä–∞–≤–ª—è—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏;
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –±—Ä–æ–∫–µ—Ä—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º;
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Ç–æ–ø–∏–∫–∏, ACL, —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—Ä–æ–∫–µ—Ä–æ–≤) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **–ª–æ–≥–∞—Ö Raft** –∏
  —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏.

---

## üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
Kafka Cluster (KRaft Mode)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Controllers (–∏—Å–ø–æ–ª–Ω—è—é—Ç Raft-–ø—Ä–æ—Ç–æ–∫–æ–ª)    ‚îÇ
‚îÇ  - Broker 1 (Controller)                 ‚îÇ
‚îÇ  - Broker 2 (Controller)                 ‚îÇ
‚îÇ  - Broker 3 (Controller)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚ñ≤
        ‚îÇ
    Brokers (–†–∞–±–æ—á–∏–µ —É–∑–ª—ã)
```

---

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ KRaft:

| –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è                 | –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏                                                 |
|------------------------------|-------------------------------------------------------------|
| ‚ùå –ù–µ—Ç ZooKeeper              | Kafka —Å–∞–º–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏                            |
| üìÑ –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | –ù—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `process.roles` (broker, controller)        |
| ‚ö° –£–ø—Ä–æ—â—ë–Ω —Å—Ç–∞—Ä—Ç –∫–ª–∞—Å—Ç–µ—Ä–∞     | –ú–µ–Ω—å—à–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –ø—Ä–æ—â–µ –¥–µ–ø–ª–æ–π                            |
| üî• –ë—ã—Å—Ç—Ä–µ–µ failover          | –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Raft –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–µ—Ä–µ–∏–∑–±—Ä–∞–Ω–∏–∏ –ª–∏–¥–µ—Ä–∞ |

---

## üõ† –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è KRaft:

```properties
# application.properties
process.roles=broker,controller
node.id=1
controller.quorum.voters=1@localhost:9093,2@localhost:9094,3@localhost:9095
listeners=PLAINTEXT://:9092,CONTROLLER://:9093
log.dirs=/tmp/kraft-combined-logs
```

(–æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏ –±—Ä–æ–∫–µ—Ä–∞)

---

## üß™ –°–æ—Å—Ç–æ—è–Ω–∏–µ:

| –í–µ—Ä—Å–∏—è Kafka | –°–æ—Å—Ç–æ—è–Ω–∏–µ KRaft                       |
|--------------|---------------------------------------|
| 2.8.x        | Experimental                          |
| 3.0.x        | Beta                                  |
| 3.3.x+       | Production-ready (–≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É) |

–í –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö **Kafka 4.0** –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É ZooKeeper. üî•

---

## ‚ö° –ò—Ç–æ–≥–æ:

- Kafka **–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ KRaft** –∫–∞–∫ –Ω–∞ –Ω–æ–≤–æ–µ —è–¥—Ä–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–º.
- **ZooKeeper –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω**.
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã + –ø–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ + –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.

---

–•–æ—á–µ—à—å, —è –µ—â—ë –ø–æ–∫–∞–∂—É:

- –ú–∏–Ω–∏–º–∞–ª–∫—É `docker-compose` –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–∞ KRaft?
- –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç failover –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –≤ KRaft?
- –ò–ª–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ KRaft vs –æ–±—ã—á–Ω—ã–π Kafka-–±—Ä–æ–∫–µ—Ä?

üí¨ –°–∫–∞–∂–∏ ‚Äî –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é! üöÄ

---------------


–û—Ç–ª–∏—á–Ω–æ, –¥–∞–≤–∞–π —Å–æ–±–µ—Ä–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä! üî•

–í–æ—Ç —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π **`docker-compose.yml`** –¥–ª—è –∑–∞–ø—É—Å–∫–∞ **Kafka –≤ —Ä–µ–∂–∏–º–µ KRaft (
–±–µ–∑ ZooKeeper)** –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:

---

# üìÑ `docker-compose.yml`

```yaml
version: '3.8'

services:
  kafka-1:
    image: confluentinc/cp-kafka:7.4.0
    hostname: kafka-1
    container_name: kafka-1
    ports:
      - "9092:9092"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 1
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /tmp/kraft-combined-logs
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    restart: unless-stopped
```

---

# üõ† –ü–æ—è—Å–Ω–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                        | –ó–Ω–∞—á–µ–Ω–∏–µ                                               |
|-----------------------------------|--------------------------------------------------------|
| `KAFKA_PROCESS_ROLES`             | –£–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–æ–ª–∏ (`broker`, `controller`)                |
| `KAFKA_NODE_ID`                   | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —É–∑–ª–∞                                     |
| `KAFKA_CONTROLLER_QUORUM_VOTERS`  | –ö—Ç–æ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤—ã–±–æ—Ä–∞—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (`1@kafka-1:9093`) |
| `KAFKA_LISTENERS`                 | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä—Ç–æ–≤ –¥–ª—è –±—Ä–æ–∫–µ—Ä–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞             |
| `KAFKA_LOG_DIRS`                  | –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ                                     |
| `KAFKA_AUTO_CREATE_TOPICS_ENABLE` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤                        |

---

# üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å?

```bash
docker-compose up -d
```

–ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ Kafka –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ `localhost:9092` –±–µ–∑ ZooKeeper.
üöÄ

---

# üìà –ï—Å–ª–∏ —Ö–æ—á–µ—à—å **–∫–ª–∞—Å—Ç–µ—Ä** –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤?

–ü—Ä–æ—Å—Ç–æ —Å–∫–ª–æ–Ω–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å —Å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–º–∏:

- `KAFKA_NODE_ID`
- `KAFKA_CONTROLLER_QUORUM_VOTERS`
- `ports`
- –∏–º–µ–Ω–∞–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–ú–æ–≥—É —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–∞ 3 –±—Ä–æ–∫–µ—Ä–∞/–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞! üöÄ  
–•–æ—á–µ—à—å? üî• (–±—É–¥–µ—Ç —Å—Ä–∞–∑—É —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–π)

-------------------


–í–æ—Ç –ø—Ä–∏–º–µ—Ä **`docker-compose.yml`** –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka –Ω–∞ **KRaft** —Å
—Ç—Ä–µ–º—è –±—Ä–æ–∫–µ—Ä–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç–∞–∫–∂–µ –≤—ã—Å—Ç—É–ø–∞—é—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏. üöÄ

---

# üìÑ `docker-compose.yml`

```yaml
version: '3.8'

services:
  kafka-1:
    image: confluentinc/cp-kafka:7.4.0
    hostname: kafka-1
    container_name: kafka-1
    ports:
      - "9092:9092" # –ü–æ—Ä—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
      - "9093:9093" # –ü–æ—Ä—Ç –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 1
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /tmp/kraft-combined-logs
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    restart: unless-stopped

  kafka-2:
    image: confluentinc/cp-kafka:7.4.0
    hostname: kafka-2
    container_name: kafka-2
    ports:
      - "9094:9092"
      - "9095:9093"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 2
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /tmp/kraft-combined-logs
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    restart: unless-stopped

  kafka-3:
    image: confluentinc/cp-kafka:7.4.0
    hostname: kafka-3
    container_name: kafka-3
    ports:
      - "9096:9092"
      - "9097:9093"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 3
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /tmp/kraft-combined-logs
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    restart: unless-stopped
```

---

# ‚ö° –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–¢—Ä–∏ –±—Ä–æ–∫–µ—Ä–∞**: `kafka-1`, `kafka-2`, `kafka-3`.
2. –í—Å–µ –±—Ä–æ–∫–µ—Ä—ã —è–≤–ª—è—é—Ç—Å—è **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏** –∏ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ –≤—ã–±–æ—Ä–∞—Ö —á–µ—Ä–µ–∑ **KRaft**.
3. **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** —á–µ—Ä–µ–∑ Raft-–ø—Ä–æ—Ç–æ–∫–æ–ª.
4. –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –±—Ä–æ–∫–µ—Ä–∞–º:
    - `kafka-1`: `localhost:9092`
    - `kafka-2`: `localhost:9094`
    - `kafka-3`: `localhost:9096`

---

# üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:

1. **–ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞**:
   ```bash
   docker-compose up -d
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è**:
   –ò—Å–ø–æ–ª—å–∑—É–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã Kafka –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞.

   –ü—Ä–∏–º–µ—Ä: –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤
   ```bash
   docker exec kafka-1 kafka-topics --bootstrap-server kafka-1:9092 --list
   ```

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞**:
   ```bash
   docker exec kafka-1 kafka-topics --bootstrap-server kafka-1:9092 --create --topic test-topic --partitions 3 --replication-factor 3
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**:
   ```bash
   docker exec kafka-1 kafka-topics --bootstrap-server kafka-1:9092 --describe --topic test-topic
   ```

---

# üìà –ß—Ç–æ –¥–∞–ª—å—à–µ?

- –î–æ–±–∞–≤–∏—Ç—å producer/consumer –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?
- –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ Prometheus/Grafana?  
  –ü–∏—à–∏, —Å–¥–µ–ª–∞–µ–º! üöÄ

-------------------
–î–æ–±–∞–≤–∏—Ç—å producer/consumer –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?

–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! üöÄ  
–î–∞–≤–∞–π —Å—Ä–∞–∑—É —Å–¥–µ–ª–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π **producer** –∏ **consumer** —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–µ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Kafka –≤–Ω—É—Ç—Ä–∏ –Ω–∞—à–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

---

## üì§ **Producer** (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–æ–ø–∏–∫)

1. –û—Ç–∫—Ä–æ–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `kafka-1`:

```bash
docker exec -it kafka-1 bash
```

2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
kafka-console-producer --bootstrap-server kafka-1:9092 --topic test-topic
```

3. –ü–æ—è–≤–∏—Ç—Å—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é:

```plaintext
Hello from producer!
Another message!
```

(–∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter)

> ‚ùó –ï—Å–ª–∏ —Ç–æ–ø–∏–∫–∞ `test-topic` –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π –ø–µ—Ä–µ–¥ —ç—Ç–∏–º:
> ```bash
> kafka-topics --bootstrap-server kafka-1:9092 --create --topic test-topic --partitions 3 --replication-factor 3
> ```

---

## üì• **Consumer** (—á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç–æ–ø–∏–∫–∞)

–í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

1. –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É:

```bash
docker exec -it kafka-1 bash
```

2. –ó–∞–ø—É—Å—Ç–∏ consumer, —á—Ç–æ–±—ã —Å–ª—É—à–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:

```bash
kafka-console-consumer --bootstrap-server kafka-1:9092 --topic test-topic --from-beginning
```

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–∏—à—å producer'–æ–º, –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –∑–¥–µ—Å—å. üëÄ

---

## üî• –ü—Ä–∏–º–µ—Ä:

**Producer —Ç–µ—Ä–º–∏–Ω–∞–ª**:

```bash
> Hello World
> Kafka is awesome!
```

**Consumer —Ç–µ—Ä–º–∏–Ω–∞–ª**:

```plaintext
Hello World
Kafka is awesome!
```

---

## üõ† –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π):

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É —Å–æ–±—Ä–∞—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–π **—Å–∫—Ä–∏–ø—Ç** –¥–ª—è –∑–∞–ø—É—Å–∫–∞ producer/consumer –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `docker-compose exec`, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —Ç–∞–∫–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞? üî•  
(–±—É–∫–≤–∞–ª—å–Ω–æ `bash`-—Ñ–∞–π–ª –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞)

-------

–û—Ç–ª–∏—á–Ω–æ! üî•  
–î–µ—Ä–∂–∏ –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è **Kafka Producer** –∏ **Consumer** –≤ –Ω–∞—à–µ–º docker-compose –∫–ª–∞—Å—Ç–µ—Ä–µ:

---

# üìú `kafka-test.sh`

```bash
#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ Kafka –≤ —Ä–µ–∂–∏–º–µ KRaft
# –ê–≤—Ç–æ—Ä: ChatGPT

TOPIC_NAME="test-topic"
BROKER="kafka-1:9092"

echo "üîé –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–ø–∏–∫–∞: $TOPIC_NAME..."

docker exec kafka-1 kafka-topics --bootstrap-server $BROKER --list | grep -w $TOPIC_NAME > /dev/null

if [ $? -ne 0 ]; then
  echo "‚úÖ –¢–æ–ø–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞—ë–º —Ç–æ–ø–∏–∫: $TOPIC_NAME..."
  docker exec kafka-1 kafka-topics --bootstrap-server $BROKER --create --topic $TOPIC_NAME --partitions 3 --replication-factor 3
else
  echo "‚úÖ –¢–æ–ø–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."
fi

echo ""
echo "üöÄ –û—Ç–∫—Ä—ã–≤–∞–µ–º producer –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π..."
echo "(–í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –æ—Ç–∫—Ä–æ–π—Ç–µ consumer!)"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º producer
docker exec -it kafka-1 kafka-console-producer --bootstrap-server $BROKER --topic $TOPIC_NAME
```

---

# üõ† –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

1. –°–æ—Ö—Ä–∞–Ω–∏ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤ —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä `kafka-test.sh`.
2. –°–¥–µ–ª–∞–π –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x kafka-test.sh
```

3. –ó–∞–ø—É—Å—Ç–∏:

```bash
./kafka-test.sh
```

---

# ‚û° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ—Ç–∫—Ä–æ–π –≤—Ç–æ—Ä–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª –¥–ª—è Consumer:

```bash
docker exec -it kafka-1 kafka-console-consumer --bootstrap-server kafka-1:9092 --topic test-topic --from-beginning
```

–ò —Ç—ã –±—É–¥–µ—à—å –≤–∏–¥–µ—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å! üéØ

---

# üì¶ –ß—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–æ–ø–∏–∫.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ (–µ—Å–ª–∏ –Ω–µ—Ç).
- –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ producer-–∞.

---

# ‚ö° –ë–æ–Ω—É—Å

–•–æ—á–µ—à—å, –µ—â—ë –¥–æ–±–∞–≤–ª—é:
- –°–∫—Ä–∏–ø—Ç –¥–ª—è **–º–∞—Å—Å–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π** –≤ —Ç–æ–ø–∏–∫ –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞?
- –ò–ª–∏ —Å–∫—Ä–∏–ø—Ç **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ consumer –∏ producer** –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö?

–ü–∏—à–∏! üöÄ