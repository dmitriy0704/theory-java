# Kafka

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **Producer (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å)**

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç (–ø–∏—à–µ—Ç) —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka-—Ç–æ–ø–∏–∫–∏.

- –û–±—ã—á–Ω–æ —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–∫—Ä–∏–ø—Ç—ã –∏ —Ç.–¥.
- –°–æ–æ–±—â–µ–Ω–∏—è –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å –∫–ª—é—á–æ–º (–¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –Ω—É–∂–Ω—É—é
  –ø–∞—Ä—Ç–∏—Ü–∏—é).

### 2. **Consumer (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å)**

–ß–∏—Ç–∞–µ—Ç (–ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞) —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka-—Ç–æ–ø–∏–∫–æ–≤.

- –ú–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—Å—Ç—å—é **consumer group**, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∏–º consumer-–æ–º
  –∏–∑ –≥—Ä—É–ø–ø—ã.

### 3. **Topic (—Ç–æ–ø–∏–∫)**

–õ–æ–≥–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –≤ –∫–æ—Ç–æ—Ä—É—é –ø—Ä–æ–¥—é—Å–µ—Ä—ã –ø–∏—à—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —á–∏—Ç–∞—é—Ç.

- –î–µ–ª–∏—Ç—Å—è –Ω–∞ **–ø–∞—Ä—Ç–∏—Ü–∏–∏**.
- –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –Ω–∞–∑—ã–≤–∞—é—Ç –ø–æ –±–∏–∑–Ω–µ—Å-—Å–º—ã—Å–ª—É: `user-events`, `orders`, `logs`.

### 4. **Partition (–ø–∞—Ä—Ç–∏—Ü–∏—è)**

–§–∏–∑–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ —Ç–æ–ø–∏–∫–∞ –Ω–∞ —á–∞—Å—Ç–∏.

- –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å Kafka.
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π.

### 5. **Broker (–±—Ä–æ–∫–µ—Ä)**

–°–µ—Ä–≤–µ—Ä Kafka, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤.

- –ö–ª–∞—Å—Ç–µ—Ä Kafka —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±—Ä–æ–∫–µ—Ä–æ–≤.
- –ö–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–æ–ø–∏–∫–æ–≤.

### 6. **Kafka Cluster (–∫–ª–∞—Å—Ç–µ—Ä Kafka)**

–ù–∞–±–æ—Ä –±—Ä–æ–∫–µ—Ä–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤–º–µ—Å—Ç–µ –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ.

- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.
- –û–¥–∏–Ω –∏–∑ –±—Ä–æ–∫–µ—Ä–æ–≤ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º** ‚Äî –æ–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
  –ø–∞—Ä—Ç–∏—Ü–∏–π.

### 7. **Zookeeper** *(–≤ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö)*

–†–∞–Ω—å—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—Ä–æ–∫–µ—Ä–æ–≤
–∏ —Ç.–¥.

> –í –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Kafka (–Ω–∞—á–∏–Ω–∞—è —Å 2.8) –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å **–±–µ–∑
Zookeeper** ‚Äî —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **KRaft mode**.

### 8. Kraft

**KRaft** (Kafka Raft Metadata mode) ‚Äî —ç—Ç–æ **–Ω–æ–≤—ã–π —Å–ø–æ—Å–æ–± —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
–≤ Apache Kafka**, –∫–æ—Ç–æ—Ä—ã–π **–∑–∞–º–µ–Ω—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ ZooKeeper**.

> –†–∞–Ω—å—à–µ Kafka –∑–∞–≤–∏—Å–µ–ª–∞ –æ—Ç **ZooKeeper** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—Ä–æ–∫–µ—Ä–∞—Ö,
> —Ç–æ–ø–∏–∫–∞—Ö, ACL –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

**KRaft** –¥–µ–ª–∞–µ—Ç Kafka **—Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π**: —Ç–µ–ø–µ—Ä—å –≤—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏
—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ —Å–∞–º–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka**, –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ ZooKeeper.

---

## üìú KRaft —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:

- **K**afka
- **Raft** ‚Äî —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏.

---

## üî• –ü–æ—á–µ–º—É Kafka —É—à–ª–∞ –æ—Ç ZooKeeper?

| –ë—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞                              | KRaft —Ä–µ—à–∞–µ—Ç                                    |
|--------------------------------------------|-------------------------------------------------|
| üé≠ –°–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Kafka + ZooKeeper) | üì¶ –í—Å—ë –≤ –æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ Kafka                    |
| üîÑ –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è          | ‚ö° –ë—ã—Å—Ç—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Raft              |
| üî• –ú–Ω–æ–≥–æ —Ä—É—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ ZooKeeper         | üîß –ü—Ä–æ—â–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å Kafka |
| üõ° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö          | üõ° –ß–∏—Å—Ç–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Raft-–ø—Ä–æ—Ç–æ–∫–æ–ª   |

---

## üõ† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä KRaft?

- –ï—Å—Ç—å **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã** (KRaft controllers) ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±—Ä–æ–∫–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ
  —É–ø—Ä–∞–≤–ª—è—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏;
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –±—Ä–æ–∫–µ—Ä—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º;
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Ç–æ–ø–∏–∫–∏, ACL, —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—Ä–æ–∫–µ—Ä–æ–≤) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **–ª–æ–≥–∞—Ö Raft** –∏
  —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏.

---

## üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
Kafka Cluster (KRaft Mode)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Controllers (–∏—Å–ø–æ–ª–Ω—è—é—Ç Raft-–ø—Ä–æ—Ç–æ–∫–æ–ª)    ‚îÇ
‚îÇ  - Broker 1 (Controller)                 ‚îÇ
‚îÇ  - Broker 2 (Controller)                 ‚îÇ
‚îÇ  - Broker 3 (Controller)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚ñ≤
        ‚îÇ
    Brokers (–†–∞–±–æ—á–∏–µ —É–∑–ª—ã)
```

---

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ KRaft:

| –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è                 | –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏                                                 |
|------------------------------|-------------------------------------------------------------|
| ‚ùå –ù–µ—Ç ZooKeeper              | Kafka —Å–∞–º–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏                            |
| üìÑ –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | –ù—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `process.roles` (broker, controller)        |
| ‚ö° –£–ø—Ä–æ—â—ë–Ω —Å—Ç–∞—Ä—Ç –∫–ª–∞—Å—Ç–µ—Ä–∞     | –ú–µ–Ω—å—à–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –ø—Ä–æ—â–µ –¥–µ–ø–ª–æ–π                            |
| üî• –ë—ã—Å—Ç—Ä–µ–µ failover          | –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Raft –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–µ—Ä–µ–∏–∑–±—Ä–∞–Ω–∏–∏ –ª–∏–¥–µ—Ä–∞ |

---

## üõ† –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è KRaft:

```properties
# application.properties
process.roles=broker,controller
node.id=1
controller.quorum.voters=1@localhost:9093,2@localhost:9094,3@localhost:9095
listeners=PLAINTEXT://:9092,CONTROLLER://:9093
log.dirs=/tmp/kraft-combined-logs
```

(–æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏ –±—Ä–æ–∫–µ—Ä–∞)

---

## üß™ –°–æ—Å—Ç–æ—è–Ω–∏–µ:

| –í–µ—Ä—Å–∏—è Kafka | –°–æ—Å—Ç–æ—è–Ω–∏–µ KRaft                       |
|--------------|---------------------------------------|
| 2.8.x        | Experimental                          |
| 3.0.x        | Beta                                  |
| 3.3.x+       | Production-ready (–≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É) |

–í –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö **Kafka 4.0** –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É ZooKeeper. üî•

---

## ‚ö° –ò—Ç–æ–≥–æ:

- Kafka **–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ KRaft** –∫–∞–∫ –Ω–∞ –Ω–æ–≤–æ–µ —è–¥—Ä–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–º.
- **ZooKeeper –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω**.
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã + –ø–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ + –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.

---

–•–æ—á–µ—à—å, —è –µ—â—ë –ø–æ–∫–∞–∂—É:

- –ú–∏–Ω–∏–º–∞–ª–∫—É `docker-compose` –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–∞ KRaft?
- –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç failover –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –≤ KRaft?
- –ò–ª–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ KRaft vs –æ–±—ã—á–Ω—ã–π Kafka-–±—Ä–æ–∫–µ—Ä?

üí¨ –°–∫–∞–∂–∏ ‚Äî –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é! üöÄ



### 8. **Consumer Group (–≥—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π)**

–ù–∞–±–æ—Ä consumer-–æ–≤, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã–µ —Å–æ–≤–º–µ—Å—Ç–Ω–æ.

- –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É consumer-—É –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π.
