# Kafka

## Основные компоненты

### 1. **Producer (производитель)**

Отправляет (пишет) сообщения в Kafka-топики.

- Обычно это микросервисы, приложения, скрипты и т.д.
- Сообщения можно отправлять с ключом (для контроля попадания в нужную
  партицию).

### 2. **Consumer (потребитель)**

Читает (подписывается на) сообщения из Kafka-топиков.

- Может быть частью **consumer group**, чтобы обрабатывать данные параллельно.
- Гарантирует, что каждое сообщение будет обработано хотя бы одним consumer-ом
  из группы.

### 3. **Topic (топик)**

Логическая категория, в которую продюсеры пишут сообщения, а потребители читают.

- Делится на **партиции**.
- Как правило, называют по бизнес-смыслу: `user-events`, `orders`, `logs`.

### 4. **Partition (партиция)**

Физическая разбивка топика на части.

- Позволяет масштабировать Kafka.
- Обеспечивает параллелизм и упорядоченность сообщений.

### 5. **Broker (брокер)**

Сервер Kafka, который хранит партиции и обрабатывает запросы от клиентов.

- Кластер Kafka состоит из нескольких брокеров.
- Каждый брокер может хранить партиции разных топиков.

### 6. **Kafka Cluster (кластер Kafka)**

Набор брокеров, работающих вместе как единое целое.

- Обеспечивает отказоустойчивость и масштабирование.
- Один из брокеров назначается **контроллером** — он управляет распределением
  партиций.

### 7. **Zookeeper** *(в старых версиях)*

Раньше использовался для управления метаданными, отслеживания состояния брокеров
и т.д.

> В новых версиях Kafka (начиная с 2.8) есть возможность работать **без
Zookeeper** — это называется **KRaft mode**.

### 8. Kraft

**KRaft** (Kafka Raft Metadata mode) — это **новый способ управления метаданными
в Apache Kafka**, который **заменяет необходимость в ZooKeeper**.

**KRaft** делает Kafka **самодостаточной**: теперь всё хранится и
синхронизируется **внутри самого кластера Kafka**, без внешнего ZooKeeper.

**KRaft расшифровка:**

- **K**afka
- **Raft** — это алгоритм консенсуса для согласованности данных между серверами.

**Как работает кластер KRaft?**

- Есть **контроллеры** (KRaft controllers) — специальные брокеры, которые
  управляют метаданными;
- Остальные брокеры подключаются к контроллерам;
- Метаданные (топики, ACL, состояния брокеров) хранятся в **логах Raft** и
  синхронизируются между контроллерами.

### 8. **Consumer Group (группа потребителей)**

Набор consumer-ов, обрабатывающих данные совместно.

- Каждая партиция назначается только одному consumer-у внутри группы.
- Позволяет горизонтально масштабировать обработку сообщений.
