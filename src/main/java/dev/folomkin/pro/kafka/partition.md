## –ü–∞—Ä—Ç–∏—Ü–∏–∏

–ü–∞—Ä—Ç–∏—Ü–∏–∏ –≤ Apache Kafka ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç *
*–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**, **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∏ **–ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö**.
–í–æ—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã:

### 1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**

Kafka-—Ç–æ–ø–∏–∫ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ **–ø–∞—Ä—Ç–∏—Ü–∏–π** (—Ä–∞–∑–¥–µ–ª–æ–≤), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ
—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ —Ä–∞–∑–Ω—ã–º –±—Ä–æ–∫–µ—Ä–∞–º. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –ø–æ
–Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º.

**–ü—Ä–∏–º–µ—Ä**:  
–£ —Ç–µ–±—è –µ—Å—Ç—å —Ç–æ–ø–∏–∫ —Å 6 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏, –∏ –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ 3 –±—Ä–æ–∫–µ—Ä–æ–≤ ‚Äî —Ç–æ–≥–¥–∞ –∫–∞–∂–¥–∞—è –º–∞—à–∏–Ω–∞
–º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –æ–¥–∏–Ω –±—Ä–æ–∫–µ—Ä –≤—Å—ë —Å—Ä–∞–∑—É.

### 2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**

–ö–∞–∂–¥—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π **consumer** (–∏–ª–∏ consumer-–ø–æ—Ç–æ–∫), —á—Ç–æ
–ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

**–ü–ª—é—Å:** –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.  
**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –≤ consumer group –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ,
—á–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π.

### 3. **–£–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**

Kafka **–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏**.

**–ï—Å–ª–∏ –≤–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫:** –Ω—É–∂–Ω–æ –ø—Ä–æ–¥—É–º–∞—Ç—å, –ø–æ –∫–∞–∫–æ–º—É –∫–ª—é—á—É –¥–µ–ª–∞—Ç—å
–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, user_id), —á—Ç–æ–±—ã –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
—à–ª–∏ –≤ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–∞—Ä—Ç–∏—Ü–∏—é.

### 4. **–§–∏–∑–∏—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è**

–ü–∞—Ä—Ç–∏—Ü–∏–∏ ‚Äî —ç—Ç–æ –ø–æ —Å—É—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥-—Ñ–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö —É–¥–æ–±–Ω—ã–º–∏ –¥–ª—è
—Ö—Ä–∞–Ω–µ–Ω–∏—è, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

### 5. **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**

–ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å **—Ä–µ–ø–ª–∏–∫–∏** –Ω–∞ –¥—Ä—É–≥–∏—Ö –±—Ä–æ–∫–µ—Ä–∞—Ö (–≤—Ç–æ—Ä–∏—á–Ω—ã–µ –∫–æ–ø–∏–∏),
—á—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É —É—Å—Ç–æ–π—á–∏–≤–æ–π –∫ —Å–±–æ—è–º.

---------

> ## - –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –∏–∑ java

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! üîß –†–∞–±–æ—Ç–∞ —Å **–ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ Kafka –∏–∑ Java** –ø–æ–∑–≤–æ–ª—è–µ—Ç
–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, **–≤ –∫–∞–∫—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ**, –∞ —Ç–∞–∫–∂–µ **—á–∏—Ç–∞—Ç—å –∏–∑
–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π**. –≠—Ç–æ –≤–∞–∂–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º, –ø–æ—Ä—è–¥–∫–æ–º
–∏–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π.

–†–∞–∑–±–µ—Ä—ë–º –ø–æ —á–∞—Å—Ç—è–º:

---

## üì® 1. Producer: –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é

### –ü—Ä–∏–º–µ—Ä: Java Kafka Producer —Å —Ä—É—á–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–∞—Ä—Ç–∏—Ü–∏–∏

```java
import org.apache.kafka.clients.producer.*;

import java.util.Properties;

public class CustomPartitionProducer {

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,
                "org.apache.kafka.common.serialization.StringSerializer");
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,
                "org.apache.kafka.common.serialization.StringSerializer");

        KafkaProducer<String, String> producer = new KafkaProducer<>(props);

        String topic = "example-topic";
        String key = "user-123";
        String value = "Hello with partition!";
        int partition = 1; // –≤—Ä—É—á–Ω—É—é —É–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä—Ç–∏—Ü–∏—é

        ProducerRecord<String, String> record = new ProducerRecord<>(topic, partition, key, value);
        producer.send(record, (metadata, exception) -> {
            if (exception == null) {
                System.out.printf("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ partition %d —Å offset %d%n",
                        metadata.partition(), metadata.offset());
            } else {
                exception.printStackTrace();
            }
        });

        producer.close();
    }
}
```

---

## üîÑ 2. Consumer: —á—Ç–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π

### –ò—Å–ø–æ–ª—å–∑—É–µ–º `assign()` –≤–º–µ—Å—Ç–æ `subscribe()`

```java
import org.apache.kafka.clients.consumer.*;
import org.apache.kafka.common.TopicPartition;

import java.time.Duration;
import java.util.*;

public class SpecificPartitionConsumer {

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        props.put(ConsumerConfig.GROUP_ID_CONFIG, "manual-partition-consumer");
        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG,
                "org.apache.kafka.common.serialization.StringDeserializer");
        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG,
                "org.apache.kafka.common.serialization.StringDeserializer");
        props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");

        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);

        String topic = "example-topic";
        int partition = 1;

        TopicPartition topicPartition = new TopicPartition(topic, partition);
        consumer.assign(List.of(topicPartition));

        while (true) {
            ConsumerRecords<String, String> records = consumer.poll(Duration.ofSeconds(1));
            for (ConsumerRecord<String, String> record : records) {
                System.out.printf("üì• Partition: %d | Offset: %d | Value: %s%n",
                        record.partition(), record.offset(), record.value());
            }
        }
    }
}
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —É–∑–Ω–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–∏—Ü–∏–π —É —Ç–æ–ø–∏–∫–∞

```java
List<PartitionInfo> partitions = producer.partitionsFor("example-topic");
for(
PartitionInfo p :partitions){
        System.out.

println("üß© Partition: "+p.partition());
        }
```

---

## üß† –ó–∞—á–µ–º —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω—É–∂–Ω–æ?

| –°—Ü–µ–Ω–∞—Ä–∏–π                              | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π                           |
|---------------------------------------|-----------------------------------------------|
| üßæ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π  | –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–Ω–∏–º –∫–ª—é—á–æ–º ‚Üí 1 –ø–∞—Ä—Ç–∏—Ü–∏—è     |
| ‚öñÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏              | –†—É—á–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º             |
| üì¶ –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ | –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ userId, location, type –∏ —Ç.–¥.    |
| üì§ Replay / offload                   | –ß–∏—Ç–∞—Ç—å –≤—Ä—É—á–Ω—É—é —Å offset'–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ |

---

–•–æ—á–µ—à—å:

- –ü—Ä–∏–º–µ—Ä —Å **Spring Kafka –∏ `@KafkaListener` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é**?
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—é **custom partitioner** (–ø–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ)?
- –ü—Ä–∏–º–µ—Ä —Å **seekToBeginning() / seekToOffset()**?

–Ø –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë üôå

---- 

- –ü—Ä–∏–º–µ—Ä —Å Spring Kafka –∏ @KafkaListener –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é?

–ö–æ–Ω–µ—á–Ω–æ! üôå –í–æ—Ç –∫–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@KafkaListener` –≤ **Spring Kafka** –¥–ª—è
–ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π** —Ç–æ–ø–∏–∫–∞ ‚Äî —É–¥–æ–±–Ω–æ, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å
–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ
—Ç–∏–ø–∞ –æ—Ç–¥–µ–ª—å–Ω–æ.

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä: `@KafkaListener` —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø–∞—Ä—Ç–∏—Ü–∏—è–º

```java
import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.stereotype.Component;

@Component
public class PartitionedListener {

    @KafkaListener(
            topicPartitions = {
                    @org.springframework.kafka.annotation.TopicPartition(
                            topic = "example-topic",
                            partitions = {"0", "1"}  // —Å–ª—É—à–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–∞—Ä—Ç–∏—Ü–∏–∏ 0 –∏ 1
                    )
            },
            groupId = "partitioned-group"
    )
    public void listenToSpecificPartitions(ConsumerRecord<String, String> record) {
        System.out.printf("üîä Message from partition %d: %s%n",
                record.partition(), record.value());
    }
}
```

---

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

| –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è                 | –û–ø–∏—Å–∞–Ω–∏–µ                                                  |
|---------------------------|-----------------------------------------------------------|
| `@KafkaListener`          | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Kafka-—Å–æ–æ–±—â–µ–Ω–∏—è                               |
| `topicPartitions`         | –ü—Ä–∏–≤—è–∑–∫–∞ –∫ **–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –ø–∞—Ä—Ç–∏—Ü–∏—è–º**                     |
| `partitions = {"0", "1"}` | –°–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏                         |
| `ConsumerRecord<K, V>`    | –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ partition, offset, key –∏ —Ç.–¥. |

---

## üß† –ü–æ–ª–µ–∑–Ω–æ –∑–Ω–∞—Ç—å

- –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —Å `concurrency = 1`** (–∏–ª–∏ —Ç—ã —Å–∞–º –æ–±—è–∑–∞–Ω –æ–±–µ—Å–ø–µ—á–∏—Ç—å
  –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏).
- –î–ª—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π
  `@KafkaListener(topic = "...")` ‚Äî Spring —Å–∞–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏.
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@KafkaListener` —Å `concurrency` –∏ —É–∫–∞–∑–∞–Ω–∏–µ–º
  `topicPartitions` –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–æ –Ω—É–∂–Ω–æ –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º
  –ø–æ—Ç–æ–∫–æ–≤).

---

## üîÑ –ü—Ä–∏–º–µ—Ä —Å `concurrency`

```java

@KafkaListener(
        topicPartitions = {
                @TopicPartition(topic = "example-topic", partitions = {"2", "3"})
        },
        groupId = "group-X",
        concurrency = "2"
)
public void listenWithConcurrency(String message) {
    System.out.println("‚öôÔ∏è " + message);
}
```

---

–•–æ—á–µ—à—å:

- –ü—Ä–∏–º–µ—Ä —Å **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**?
- –ü—Ä–∏–º–µ—Ä —Å **–æ–±—Ä–∞–±–æ—Ç–∫–æ–π offset –≤—Ä—É—á–Ω—É—é**?
- –ò–ª–∏, –Ω–∞–æ–±–æ—Ä–æ—Ç, —á—Ç–æ–±—ã **–≤—Å—ë —Ç–æ–ø–∏–∫ + –≤—Å–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ?

--------------------


–û—Ç–ª–∏—á–Ω–æ! üéØ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–∏ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ **Kafka Producer —Å–∞–º
–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≤ –∫–∞–∫—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ**, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏–π (
–Ω–∞–ø—Ä–∏–º–µ—Ä, `userId`, `region`, `orderId`, –∏ —Ç.–¥.).

---

## ‚úÖ –¶–µ–ª—å:

–ú—ã —Ö–æ—Ç–∏–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **—Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π `Partitioner`**, –∫–æ—Ç–æ—Ä—ã–π
–±—É–¥–µ—Ç:

- –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–∞;
- —É—á–∏—Ç—ã–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, `userId % partitionCount`.

---

## üì¶ 1. –ö–∞—Å—Ç–æ–º–Ω—ã–π Partitioner

–°–æ–∑–¥–∞–¥–∏–º –∫–ª–∞—Å—Å `UserIdPartitioner`:

```java
import org.apache.kafka.clients.producer.Partitioner;
import org.apache.kafka.common.Cluster;

import java.util.Map;

public class UserIdPartitioner implements Partitioner {

    @Override
    public int partition(String topic, Object key, Object value, byte[] keyBytes, byte[] valueBytes, Cluster cluster) {
        int partitionCount = cluster.partitionCountForTopic(topic);

        if (key == null) {
            return 0; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }

        // –ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ key = "user-123", –±–µ—Ä—ë–º hash-table.md, –¥–µ–ª–∏–º –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π
        return Math.abs(key.hashCode()) % partitionCount;
    }

    @Override
    public void close() {
        // –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —á—Ç–æ-—Ç–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å
    }

    @Override
    public void configure(Map<String, ?> configs) {
        // –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    }
}
```

---

## ‚öôÔ∏è 2. ProducerConfig: —É–∫–∞–∑–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–µ—Ä–∞

```java
Properties props = new Properties();
props.

put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
props.

put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, "org.apache.kafka.common.serialization.StringSerializer");
props.

put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, "org.apache.kafka.common.serialization.StringSerializer");

// –í–ê–ñ–ù–û: –ø–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–µ—Ä
props.

put(ProducerConfig.PARTITIONER_CLASS_CONFIG, "com.example.kafka.partition.UserIdPartitioner");
```

---

## üöÄ 3. –ü—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```java
KafkaProducer<String, String> producer = new KafkaProducer<>(props);

String topic = "dynamic-topic";
String userId = "user-42"; // —ç—Ç–æ –∏ –±—É–¥–µ—Ç –∫–ª—é—á–æ–º –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

ProducerRecord<String, String> record = new ProducerRecord<>(topic, userId, "–°–æ–±—ã—Ç–∏–µ –¥–ª—è " + userId);
producer.

send(record, (metadata, exception) ->{
        if(exception ==null){
        System.out.

printf("‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ partition %d (offset %d)%n",metadata.partition(),metadata.

offset());
        }else{
        exception.

printStackTrace();
    }
            });

            producer.

close();
```

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

- Kafka –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ `partition(...)` –ø—Ä–∏ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ.
- –¢—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –ø–∞—Ä—Ç–∏—Ü–∏–∏.
- Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–∑–Ω–∞—ë—Ç, —Å–∫–æ–ª—å–∫–æ –ø–∞—Ä—Ç–∏—Ü–∏–π —É —Ç–æ–ø–∏–∫–∞ ‚Äî
  `cluster.partitionCountForTopic(topic)`.

---

## üß† –ö–µ–π—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

| –õ–æ–≥–∏–∫–∞               | –ü–∞—Ä—Ç–∏—Ü–∏—è                                      |
|----------------------|-----------------------------------------------|
| `userId % N`         | –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |
| `region -> –ø–∞—Ä—Ç–∏—Ü–∏—è` | –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è                    |
| `priority == HIGH`   | –í –æ—Å–æ–±—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é                             |

---

## üß™ –•–æ—á–µ—à—å —Ç–µ—Å—Ç?

–ú–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ `UserIdPartitioner` –≤—ã–±–∏—Ä–∞–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏
–¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–µ–π üòâ

---

–ù—É–∂–Ω–æ:

- –ø—Ä–∏–º–µ—Ä —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º `Partitioner` –≤ Spring Kafka?
- `Partitioner` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ JSON?
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∫–∏ –∏–ª–∏ MDC –≤ Kafka-–ø–∞–π–ø–ª–∞–π–Ω?

–Ø –ø–æ–∫–∞–∂—É, –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ üôå


----------------
unit-—Ç–µ—Å—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ `UserIdPartitioner` –≤—ã–±–∏—Ä–∞–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏
–¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–µ–π üòâ

–° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º! üß™ –î–∞–≤–∞–π –Ω–∞–ø–∏—à–µ–º unit-—Ç–µ—Å—Ç –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ `Partitioner`, —á—Ç–æ–±—ã
—É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–∞.

---

## ‚úÖ 1. –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–∫–æ–π `UserIdPartitioner`:

```java
public class UserIdPartitioner implements Partitioner {

    @Override
    public int partition(String topic, Object key, Object value, byte[] keyBytes,
                         byte[] valueBytes, Cluster cluster) {
        int partitionCount = cluster.partitionCountForTopic(topic);
        return (key == null) ? 0 : Math.abs(key.hashCode()) % partitionCount;
    }

    @Override
    public void configure(Map<String, ?> configs) {
    }

    @Override
    public void close() {
    }
}
```

---

## ‚úÖ 2. –ù–∞–ø–∏—à–µ–º JUnit-—Ç–µ—Å—Ç (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Mockito)

```java
import org.apache.kafka.common.Cluster;
import org.apache.kafka.common.PartitionInfo;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.util.List;
import java.util.Map;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class UserIdPartitionerTest {

    private UserIdPartitioner partitioner;
    private Cluster cluster;

    @BeforeEach
    void setUp() {
        partitioner = new UserIdPartitioner();

        // –ú–æ–∫–∞–µ–º –∫–ª–∞—Å—Ç–µ—Ä —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏
        List<PartitionInfo> partitions = List.of(
                new PartitionInfo("test-topic", 0, null, null, null),
                new PartitionInfo("test-topic", 1, null, null, null),
                new PartitionInfo("test-topic", 2, null, null, null)
        );
        cluster = mock(Cluster.class);
        when(cluster.partitionCountForTopic("test-topic")).thenReturn(partitions.size());
    }

    @Test
    void testPartitionIsConsistentForSameKey() {
        String topic = "test-topic";
        String key = "user-123";

        int partition1 = partitioner.partition(topic, key, null, null, null, cluster);
        int partition2 = partitioner.partition(topic, key, null, null, null, cluster);

        assertEquals(partition1, partition2, "Partition for same key should be consistent");
        assertTrue(partition1 >= 0 && partition1 < 3, "Partition index must be valid");
    }

    @Test
    void testPartitionIsZeroForNullKey() {
        String topic = "test-topic";
        int partition = partitioner.partition(topic, null, "value", null, null, cluster);

        assertEquals(0, partition, "Partition should be 0 when key is null");
    }
}
```

---

## üì¶ –ß—Ç–æ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º

| –¢–µ—Å—Ç                          | –ü—Ä–æ–≤–µ—Ä–∫–∞                                           |
|-------------------------------|----------------------------------------------------|
| `same key ‚Üí same partition`   | –°–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∫–ª—é—á–æ–º –∏–¥—É—Ç –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é |
| `key == null ‚Üí partition = 0` | –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ –∑–∞–¥–∞–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –ø–∞—Ä—Ç–∏—Ü–∏—é 0        |
| `valid partition range`       | –ü–∞—Ä—Ç–∏—Ü–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç `0` –¥–æ `partitionCount - 1` |

---

## üß∞ –¢—Ä–µ–±—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Maven)

```xml

<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter</artifactId>
    <version>5.9.3</version>
    <scope>test</scope>
</dependency>
<dependency>
<groupId>org.mockito</groupId>
<artifactId>mockito-core</artifactId>
<version>5.11.0</version>
<scope>test</scope>
</dependency>
```

---

–•–æ—á–µ—à—å:

- –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `Partitioner` –Ω–∞ –æ—Å–Ω–æ–≤–µ JSON-–ø–æ–ª—è?
- –ø—Ä–∏–º–µ—Ä —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ç–µ—Å—Ç–æ–º Kafka + TestContainers?

–ú–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å üí°


----------

–ø—Ä–∏–º–µ—Ä —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ç–µ—Å—Ç–æ–º Kafka + TestContainers?

–ö–æ–Ω–µ—á–Ω–æ! üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å **Kafka + Testcontainers** ‚Äî –º–æ—â–Ω—ã–π —Å–ø–æ—Å–æ–± *
*—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Kafka-–ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤ –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤ –≤ –∂–∏–≤–æ–π —Å—Ä–µ–¥–µ**, –Ω–µ –ø–æ–¥–Ω–∏–º–∞—è –∫–ª–∞—Å—Ç–µ—Ä
–≤—Ä—É—á–Ω—É—é.

---

## üîß –ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–µ–º:

- –ó–∞–ø—É—Å—Ç–∏–º Kafka —á–µ—Ä–µ–∑ Testcontainers;
- –ù–∞–ø–∏—à–µ–º —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π:
    - —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–ø–∏–∫;
    - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ;
    - —á–∏—Ç–∞–µ—Ç –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ Consumer.

---

## ‚úÖ 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Maven)

```xml

<dependencies>
    <!-- Spring Kafka -->
    <dependency>
        <groupId>org.springframework.kafka</groupId>
        <artifactId>spring-kafka</artifactId>
    </dependency>

    <!-- Testcontainers Kafka -->
    <dependency>
        <groupId>org.testcontainers</groupId>
        <artifactId>kafka</artifactId>
        <version>1.19.3</version>
        <scope>test</scope>
    </dependency>

    <!-- JUnit 5 -->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter</artifactId>
        <version>5.9.3</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

---

## ‚úÖ 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç

```java
import org.apache.kafka.clients.consumer.ConsumerConfig;
import org.apache.kafka.clients.consumer.KafkaConsumer;
import org.apache.kafka.clients.consumer.ConsumerRecords;
import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.apache.kafka.clients.producer.*;
import org.apache.kafka.common.serialization.StringDeserializer;
import org.apache.kafka.common.serialization.StringSerializer;
import org.junit.jupiter.api.*;
import org.testcontainers.containers.KafkaContainer;
import org.testcontainers.utility.DockerImageName;

import java.time.Duration;
import java.util.*;

import static org.junit.jupiter.api.Assertions.*;

public class KafkaIntegrationTest {

    static KafkaContainer kafka;

    @BeforeAll
    static void startKafka() {
        kafka = new KafkaContainer(DockerImageName.parse("confluentinc/cp-kafka:7.5.0"));
        kafka.start();
    }

    @AfterAll
    static void stopKafka() {
        kafka.stop();
    }

    @Test
    void testProduceAndConsume() {
        String topic = "test-topic";

        // Producer config
        Properties producerProps = new Properties();
        producerProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, kafka.getBootstrapServers());
        producerProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());
        producerProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());

        // Send message
        KafkaProducer<String, String> producer = new KafkaProducer<>(producerProps);
        producer.send(new ProducerRecord<>(topic, "key-1", "hello from test")).join();
        producer.close();

        // Consumer config
        Properties consumerProps = new Properties();
        consumerProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafka.getBootstrapServers());
        consumerProps.put(ConsumerConfig.GROUP_ID_CONFIG, "test-group");
        consumerProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        consumerProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        consumerProps.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");

        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(consumerProps);
        consumer.subscribe(List.of(topic));

        ConsumerRecords<String, String> records = consumer.poll(Duration.ofSeconds(5));
        consumer.close();

        List<ConsumerRecord<String, String>> recordList = new ArrayList<>();
        records.forEach(recordList::add);

        assertFalse(recordList.isEmpty(), "Expected at least one record");
        assertEquals("hello from test", recordList.get(0).value());
    }
}
```

---

## üî• –ß—Ç–æ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å:

- **–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Kafka-–±—Ä–æ–∫–µ—Ä** –Ω–∞ Docker –≤ —Ç–µ—Å—Ç–µ;
- –ù–∞–¥—ë–∂–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º CI/CD-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Kafka –ª–æ–≥–∏–∫–∏;
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ Spring-—Ç–µ—Å—Ç–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å `@Testcontainers`.

---

## ‚ö°Ô∏è –ë–æ–Ω—É—Å: –ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@SpringBootTest`

–¢—ã –º–æ–∂–µ—à—å –ø–æ–¥–Ω—è—Ç—å Kafka —Å Testcontainers –∏ **–ø—Ä–æ–∫–∏–Ω—É—Ç—å –ø–æ—Ä—Ç –≤ `application.yml`
** —á–µ—Ä–µ–∑ `@DynamicPropertySource`.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –ø–æ–∫–∞–∂—É —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç —Ç–æ–∂–µ!

---

–•–æ—á–µ—à—å —Ä–∞—Å—à–∏—Ä–∏—Ç—å:

- üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Listener —á–µ—Ä–µ–∑ `@KafkaListener`?
- üîé –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `JsonDeserializer`?
- üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å `KafkaAdmin` –∏ auto-create topics?

–°–∫–∞–∂–∏ ‚Äî –ø–æ–∫–∞–∂—É üß™‚ú®

----------

üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å KafkaAdmin –∏ auto-create topics?

–û—Ç–ª–∏—á–Ω–æ! üîß –î–∞–≤–∞–π –Ω–∞—Å—Ç—Ä–æ–∏–º Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
—Å–æ–∑–¥–∞–≤–∞–ªo Kafka-—Ç–æ–ø–∏–∫–∏** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, –∏—Å–ø–æ–ª—å–∑—É—è `KafkaAdmin`.

---

## ‚úÖ –ß—Ç–æ –±—É–¥–µ—Ç:

- –ò—Å–ø–æ–ª—å–∑—É–µ–º `KafkaAdmin` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–ª–∞—Å—Ç–µ—Ä—É;
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ (`NewTopic`);
- –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üì¶ 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pom.xml`)

```xml

<dependency>
    <groupId>org.springframework.kafka</groupId>
    <artifactId>spring-kafka</artifactId>
</dependency>
```

---

## ‚öôÔ∏è 2. `application.yml`

```yaml
spring:
  kafka:
    bootstrap-servers: localhost:9092
    client-id: my-kafka-app
    admin:
      properties:
        retries: 3
```

---

## üß† 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `KafkaAdmin` –∏ `NewTopic`

```java
import org.apache.kafka.clients.admin.NewTopic;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.kafka.config.TopicBuilder;
import org.springframework.kafka.core.KafkaAdmin;

@Configuration
public class KafkaTopicConfig {

    @Bean
    public KafkaAdmin kafkaAdmin() {
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Kafka
        Map<String, Object> configs = new HashMap<>();
        configs.put("bootstrap.servers", "localhost:9092");
        return new KafkaAdmin(configs);
    }

    @Bean
    public NewTopic userEventsTopic() {
        return TopicBuilder.name("user-events")
                .partitions(3)
                .replicas(1)
                .build();
    }

    @Bean
    public NewTopic auditLogsTopic() {
        return TopicBuilder.name("audit-logs")
                .partitions(1)
                .replicas(1)
                .compact() // –ü—Ä–∏–º–µ—Ä —Å compact-—Å–µ–≥–º–µ–Ω—Ç–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                .build();
    }
}
```

---

## üîç –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Spring?

- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Spring:
    1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `KafkaAdmin`;
    2. –ß–∏—Ç–∞–µ—Ç –≤—Å–µ –±–∏–Ω—ã `NewTopic`;
    3. –°–æ–∑–¥–∞—ë—Ç —Ç–æ–ø–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ **–µ—â—ë –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç** –≤ Kafka.

> üí° –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç —Ç–æ–ø–∏–∫–∏ ‚Äî Kafka –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å.

---

## üõë –í–∞–∂–Ω–æ:

- Kafka **–Ω–µ –∏–∑–º–µ–Ω–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–æ–ø–∏–∫–∞**, –µ—Å–ª–∏ –æ–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä,
  –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π ‚Äî –Ω–µ–ª—å–∑—è).
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `kafkaAdmin` **—Ç–æ–ª—å–∫–æ –≤ DEV/CI** –∏–ª–∏ –ø—Ä–∏
  –º–∏–≥—Ä–∞—Ü–∏—è—Ö.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–µ

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ —Ç—ã —É–≤–∏–¥–∏—à—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

```
Created topic user-events with 3 partitions and 1 replicas.
```

---

## üéÅ –ë–æ–Ω—É—Å:

–•–æ—á–µ—à—å REST-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è **–¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–ø–∏–∫–æ–≤ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã** –∏–ª–∏ **—É–¥–∞–ª–µ–Ω–∏—è
–ø–æ –∏–º–µ–Ω–∏/—à–∞–±–ª–æ–Ω—É**? –≠—Ç–æ —Ç–æ–∂–µ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å!

–ì–æ—Ç–æ–≤ –ø–æ–∫–∞–∑–∞—Ç—å üëá

–û—Ç–ª–∏—á–Ω–æ! üöÄ –î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º **REST-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Kafka-—Ç–æ–ø–∏–∫–∞–º–∏**:

- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É;
- üóë –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ –ø–æ –∏–º–µ–Ω–∏;
- üßπ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ —à–∞–±–ª–æ–Ω—É;
- üìú –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ç–µ–∫—É—â–∏—Ö —Ç–æ–ø–∏–∫–æ–≤.

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã):

```xml

<dependency>
    <groupId>org.springframework.kafka</groupId>
    <artifactId>spring-kafka</artifactId>
</dependency>
<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

---

## üîß KafkaAdminService (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞–º–∏)

```java
import org.apache.kafka.clients.admin.*;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import java.util.*;
import java.util.concurrent.ExecutionException;
import java.util.stream.Collectors;

@Service
public class KafkaAdminService {

    private final AdminClient adminClient;

    public KafkaAdminService(@Value("${spring.kafka.bootstrap-servers}") String bootstrapServers) {
        Properties props = new Properties();
        props.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
        this.adminClient = AdminClient.create(props);
    }

    public void createTopic(String name, int partitions, short replicas) throws ExecutionException, InterruptedException {
        NewTopic topic = new NewTopic(name, partitions, replicas);
        adminClient.createTopics(Collections.singleton(topic)).all().get();
    }

    public void deleteTopic(String name) throws ExecutionException, InterruptedException {
        adminClient.deleteTopics(Collections.singleton(name)).all().get();
    }

    public List<String> listTopics() throws ExecutionException, InterruptedException {
        return new ArrayList<>(adminClient.listTopics().names().get());
    }

    public List<String> deleteTopicsByPrefix(String prefix) throws ExecutionException, InterruptedException {
        List<String> toDelete = listTopics().stream()
                .filter(name -> name.startsWith(prefix))
                .collect(Collectors.toList());
        adminClient.deleteTopics(toDelete).all().get();
        return toDelete;
    }
}
```

---

## üåê KafkaTopicController

```java
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.concurrent.ExecutionException;

@RestController
@RequestMapping("/api/kafka")
public class KafkaTopicController {

    private final KafkaAdminService kafkaAdminService;

    public KafkaTopicController(KafkaAdminService kafkaAdminService) {
        this.kafkaAdminService = kafkaAdminService;
    }

    @PostMapping("/topics")
    public String createTopic(@RequestParam String name,
                              @RequestParam(defaultValue = "1") int partitions,
                              @RequestParam(defaultValue = "1") short replicas) throws Exception {
        kafkaAdminService.createTopic(name, partitions, replicas);
        return "‚úÖ Topic created: " + name;
    }

    @DeleteMapping("/topics/{name}")
    public String deleteTopic(@PathVariable String name) throws Exception {
        kafkaAdminService.deleteTopic(name);
        return "üóë Topic deleted: " + name;
    }

    @GetMapping("/topics")
    public List<String> listTopics() throws Exception {
        return kafkaAdminService.listTopics();
    }

    @DeleteMapping("/topics/prefix/{prefix}")
    public List<String> deleteByPrefix(@PathVariable String prefix) throws Exception {
        return kafkaAdminService.deleteTopicsByPrefix(prefix);
    }
}
```

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

**–°–æ–∑–¥–∞–Ω–∏–µ:**

```http
POST /api/kafka/topics?name=my-topic&partitions=3&replicas=1
```

**–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏:**

```http
DELETE /api/kafka/topics/my-topic
```

**–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É:**

```http
DELETE /api/kafka/topics/prefix/test-
```

**–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–ø–∏–∫–æ–≤:**

```http
GET /api/kafka/topics
```

---

## üöÄ –•–æ—á–µ—à—å –±–æ–Ω—É—Å?

> - ## –î–æ–±–∞–≤–∏—Ç—å **Swagger UI** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–∏—Ö —Ä—É—á–µ–∫?
–û—Ç–ª–∏—á–Ω–æ! üéâ –î–∞–≤–∞–π –¥–æ–±–∞–≤–∏–º **Swagger UI** (—á–µ—Ä–µ–∑ Springdoc OpenAPI), —á—Ç–æ–±—ã —É–¥–æ–±–Ω–æ
—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à Kafka REST API –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.

---

## ‚úÖ 1. –î–æ–±–∞–≤—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `pom.xml`

```xml

<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
    <version>2.2.0</version>
</dependency>
```

---

## üõ† 2. Swagger –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç —Ç–≤–æ–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ `@RestController`, `@RequestMapping`,
`@GetMapping` –∏ —Ç.–ø. ‚Äî Swagger –≤—Å—ë —Å–∞–º –Ω–∞–π–¥—ë—Ç. –ù–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–º–Ω–æ–≥–æ
–æ–ø–∏—Å–∞–Ω–∏–π –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã:

```java
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;

@RestController
@RequestMapping("/api/kafka")
@Tag(name = "Kafka Topic Management", description = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞–º–∏ Kafka")
public class KafkaTopicController {

    private final KafkaAdminService kafkaAdminService;

    public KafkaTopicController(KafkaAdminService kafkaAdminService) {
        this.kafkaAdminService = kafkaAdminService;
    }

    @Operation(summary = "–°–æ–∑–¥–∞—Ç—å Kafka-—Ç–æ–ø–∏–∫")
    @PostMapping("/topics")
    public String createTopic(@RequestParam String name,
                              @RequestParam(defaultValue = "1") int partitions,
                              @RequestParam(defaultValue = "1") short replicas) throws Exception {
        kafkaAdminService.createTopic(name, partitions, replicas);
        return "‚úÖ Topic created: " + name;
    }

    @Operation(summary = "–£–¥–∞–ª–∏—Ç—å Kafka-—Ç–æ–ø–∏–∫")
    @DeleteMapping("/topics/{name}")
    public String deleteTopic(@PathVariable String name) throws Exception {
        kafkaAdminService.deleteTopic(name);
        return "üóë Topic deleted: " + name;
    }

    @Operation(summary = "–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö Kafka-—Ç–æ–ø–∏–∫–æ–≤")
    @GetMapping("/topics")
    public List<String> listTopics() throws Exception {
        return kafkaAdminService.listTopics();
    }

    @Operation(summary = "–£–¥–∞–ª–∏—Ç—å —Ç–æ–ø–∏–∫–∏ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É")
    @DeleteMapping("/topics/prefix/{prefix}")
    public List<String> deleteByPrefix(@PathVariable String prefix) throws Exception {
        return kafkaAdminService.deleteTopicsByPrefix(prefix);
    }
}
```

---

## üåê 3. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Swagger –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:8080/swagger-ui.html
```

–∏–ª–∏

```
http://localhost:8080/swagger-ui/index.html
```

(–æ–±–∞ —Ä–∞–±–æ—Ç–∞—é—Ç, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏)

---

## üìú –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ:

–î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ API:

```yaml
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Kafka REST API –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –±–µ–∑ Postman, curl
–∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å:

- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, JWT)?
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –ø–æ —Ç–µ–≥–∞–º?
- ‚úÖ –ü—Ä–∏–º–µ—Ä JSON-—Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞?

–ü–∏—à–∏ ‚Äî –¥–æ–±–∞–≤–ª—é üí™

> - ## –ò–ª–∏ –∑–∞—â–∏—Ç—É —á–µ—Ä–µ–∑ Spring Security?

–û—Ç–ª–∏—á–Ω–æ! üíÇ‚Äç‚ôÇÔ∏è –î–∞–≤–∞–π –¥–æ–±–∞–≤–∏–º **Spring Security** –∫ –Ω–∞—à–µ–º—É Kafka REST API, —á—Ç–æ–±—ã
Swagger –∏ —Ä—É—á–∫–∏ –±—ã–ª–∏ –∑–∞—â–∏—â–µ–Ω—ã ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –ª–æ–≥–∏–Ω—É –∏ –ø–∞—Ä–æ–ª—é (basic auth), –∏–ª–∏
—Ç–æ–∫–µ–Ω—É (JWT ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é).

---

## üõ† –ß—Ç–æ —Å–¥–µ–ª–∞–µ–º:

- –í–∫–ª—é—á–∏–º Spring Security;
- –î–æ–±–∞–≤–∏–º –±–∞–∑–æ–≤—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (`username/password`);
- –ó–∞—â–∏—Ç–∏–º Swagger –∏ REST API;
- –î–æ–±–∞–≤–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–∞–º—è—Ç–∏;
- –ú–æ–∂–Ω–æ –±—É–¥–µ—Ç —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ JWT, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

---

## ‚úÖ 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ `pom.xml`

```xml

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

---

## üîê 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spring Security

–°–æ–∑–¥–∞—ë–º `SecurityConfig.java`:

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .authorizeHttpRequests(auth -> auth
                        .requestMatchers("/swagger-ui/**", "/v3/api-docs/**").permitAll()
                        .anyRequest().authenticated()
                )
                .httpBasic(Customizer.withDefaults()); // Basic Auth

        return http.build();
    }

    @Bean
    public UserDetailsService userDetailsService() {
        return new InMemoryUserDetailsManager(
                User.withUsername("admin")
                        .password("{noop}admin123") // {noop} ‚Äî –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
                        .roles("ADMIN")
                        .build()
        );
    }
}
```

---

## üîë 3. –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API –∏–ª–∏ Swagger:

- –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∂–µ—Ç **basic auth** –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å;
- –í–≤–µ—Å—Ç–∏:
    - **–ª–æ–≥–∏–Ω**: `admin`
    - **–ø–∞—Ä–æ–ª—å**: `admin123`

---

## üåê Swagger UI —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π:

–¢—ã –º–æ–∂–µ—à—å –Ω–∞–∂–∞—Ç—å **Authorize** –≤ Swagger UI –∏ –≤–≤–µ—Å—Ç–∏ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å. Swagger
–æ—Ç–ø—Ä–∞–≤–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Basic ...` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —Ç–≤–æ–π Kafka REST API –∑–∞—â–∏—â—ë–Ω –±–∞–∑–æ–≤–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

---

## ‚ö°Ô∏è –•–æ—á–µ—à—å next level?

- üîê JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ basic auth?
- üßæ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –±–∞–∑—ã (JPA)?
- üîí –†–æ–ª–∏ –Ω–∞ –º–µ—Ç–æ–¥—ã `@PreAuthorize("hasRole('ADMIN')")`?

–ü–∏—à–∏ ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏–º!

> - ## –ò–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–ø–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `.yml` –∫–æ–Ω—Ñ–∏–≥?


–û—Ç–ª–∏—á–Ω—ã–π —à–∞–≥! üîß –î–æ–±–∞–≤–∏–º –ø–æ–¥–¥–µ—Ä–∂–∫—É **Kafka-—Ç–æ–ø–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `application.yml`**,
—á—Ç–æ–±—ã –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –∏—Ö –≤ Java-–∫–æ–¥–µ, –∞ —É–¥–æ–±–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –∏–ª–∏ –≤
—Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö (dev, prod, staging –∏ —Ç.–¥.).

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–µ–º:

- –û–ø–∏—à–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤ –≤ `application.yml`;
- –°–æ–∑–¥–∞–¥–∏–º –±–∏–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, —á–∏—Ç–∞—é—â—É—é —Å–ø–∏—Å–æ–∫;
- –°–æ–∑–¥–∞–¥–∏–º —Ç–æ–ø–∏–∫–∏ —á–µ—Ä–µ–∑ `KafkaAdmin`.

---

## üìÅ 1. `application.yml`

```yaml
kafka:
  topics:
    - name: user-events
      partitions: 3
      replicas: 1
    - name: audit-logs
      partitions: 1
      replicas: 1
```

---

## üßæ 2. –ö–ª–∞—Å—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Å –±–∏–Ω-–ø—Ä–æ—á—Ç–µ–Ω–∏–µ–º —Å–ø–∏—Å–∫–∞)

### üì¶ `KafkaTopicsProperties.java`

```java
import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Configuration;

import java.util.List;

@Configuration
@ConfigurationProperties(prefix = "kafka")
@Data
public class KafkaTopicsProperties {
    private List<Topic> topics;

    @Data
    public static class Topic {
        private String name;
        private int partitions;
        private short replicas;
    }
}
```

---

## üõ† 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `KafkaAdmin` + –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤

### üì¶ `KafkaDynamicTopicConfig.java`

```java
import org.apache.kafka.clients.admin.NewTopic;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.kafka.config.TopicBuilder;
import org.springframework.kafka.core.KafkaAdmin;

import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

@Configuration
public class KafkaDynamicTopicConfig {

    private final KafkaTopicsProperties topicProps;

    public KafkaDynamicTopicConfig(KafkaTopicsProperties topicProps) {
        this.topicProps = topicProps;
    }

    @Bean
    public KafkaAdmin kafkaAdmin() {
        return new KafkaAdmin(Map.of("bootstrap.servers", "localhost:9092"));
    }

    @Bean
    public List<NewTopic> kafkaTopics() {
        return topicProps.getTopics().stream()
                .map(t -> TopicBuilder.name(t.getName())
                        .partitions(t.getPartitions())
                        .replicas(t.getReplicas())
                        .build())
                .collect(Collectors.toList());
    }
}
```

> üìå –í –±–æ–µ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ `bootstrap.servers` –º–æ–∂–Ω–æ –ø—Ä–æ–∫–∏–Ω—É—Ç—å –∏–∑ `application.yml`
> –∏–ª–∏ `.env`.

---

## ‚úÖ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Spring Boot:
    - –∑–∞–≥—Ä—É–∂–∞–µ—Ç `kafka.topics` –∏–∑ YAML;
    - —Å–æ–∑–¥–∞—ë—Ç —Å–ø–∏—Å–æ–∫ `NewTopic` –±–∏–Ω–æ–≤;
    - `KafkaAdmin` –≤–∏–¥–∏—Ç –∏—Ö –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç.

---

## üß™ –ü—Ä–∏–º–µ—Ä:

```bash
Topic created: user-events (3 partitions, 1 replica)
Topic created: audit-logs (1 partition, 1 replica)
```

---

## üí° –ë–æ–Ω—É—Å—ã:

- üîÅ –õ–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ø–∏–∫–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö;
- üß© –ì–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Spring Profiles;
- üõ° –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

---

–•–æ—á–µ—à—å:

- ‚è´ –û–±–Ω–æ–≤–ª—è—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥?
- üåê –ü–æ–∑–≤–æ–ª–∏—Ç—å REST-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É —á–∏—Ç–∞—Ç—å YAML-–∫–æ–Ω—Ñ–∏–≥?
- ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤?

–°–∫–∞–∂–∏ ‚Äî –ø–æ–∫–∞–∂—É üí™

