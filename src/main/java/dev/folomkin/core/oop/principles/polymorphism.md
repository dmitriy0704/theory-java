
# Полиморфизм

## Связывание. Позднее и раннее.

Связывание означает наличие связи между ссылкой и кодом. Например, переменная,
на которую вы ссылаетесь, привязана к коду, в котором она определена.
Аналогично, вызываемый метод привязан к месту в коде, где он определен.  
Существует два типа связывания методов в языке Java: ранее связывание (его ещё
называют статическим) и позднее (соответственно, динамическое) связывание. Вызов
метода в Java означает, что этот метод привязывается к конкретному коду или в
момент компиляции, или во время выполнения, при запуске программы и создании
объектов.  
Можно понять из названия, статическое связывание носит более статический
характер, так как происходит во время компиляции, то есть код «знает», какой
метод вызывать после компиляции исходного кода на Java в файлы классов. А
поскольку это относится к ранней стадии жизненного цикла программы, то
называется также ранним связыванием (early binding).  
С другой стороны, динамическое связывание происходит во время выполнения, после
запуска программы виртуальной машиной Java. В этом случае то, какой метод
вызвать, определяется конкретным объектом, так что в момент компиляции
информация недоступна, ведь объекты создаются во время выполнения. А поскольку
это происходит на поздней стадии жизненного цикла программы, то называется в
языке Java поздним связыванием (late binding).  
Фундаментальное различие между статическим и динамическим связыванием в Java
состоит в том, что первое происходит рано, во время компиляции на основе типа
ссылочной переменной, а второе – позднее, во время выполнения, с использованием
конкретных объектов.  
Привязка виртуальных методов не происходит во время компиляции при помощи
статического связывания, поскольку в этом случае вызывался бы метод из
суперкласса, как происходит со статическими методами, которые связываются рано.
Если будет вызван метод из подкласса, то для связывания функции использовался
конкретный объект во время выполнения, а, следовательно, для связывания
виртуальных функций используется динамическое связывание.

```java
public class Code {
    public static void main(String[] args) {
        // Пример статического и динамического связывания в Java
        Insurance current = new CarInsurance();
        // Динамическое связывание на основе объекта
        int premium = current.premium();
        // Статическое связывание на основе класса
        String category = current.category();
        System.out.println("premium : " + premium);
        System.out.println("category : " + category);
    }
}

class Insurance {
    public static final int LOW = 100;

    public int premium() {
        return LOW;
    }

    public static String category() {
        return "Insurance";
    }
}

class CarInsurance extends Insurance {
    public static final int HIGH = 200;

    public int premium() {
        return HIGH;
    }

    public static String category() {
        return "Car Insurance";
    }

}
```

Вызов метода premium() привел к выполнению метода из подкласса, в то время как
вызов метода category() привел к выполнению метода суперкласса. Это происходит
из-за того, что premium() – виртуальный метод, который разрешается при помощи
позднего связывания, в то время как category() – статический метод, который
разрешается при помощи статического связывания во время компиляции по имени
класса.

### Различия между ранним и поздним связыванием в языке Java

1. Статическое связывание происходит во время компиляции, а динамическое – во
   время выполнения.
2. Поскольку статическое связывание происходит на ранней стадии жизненного цикла
   программы, его называют ранним связыванием. Аналогично, динамическое
   связывание называют также поздним связыванием, поскольку оно происходит
   позже, во время работы программы.
3. **Статическое связывание используется в языке Java для разрешения
   перегруженных методов, в то время как динамическое связывание используется в
   языке Java для разрешения переопределенных методов.**
4. Аналогично, приватные, статические и терминальные методы разрешаются при
   помощи статического связывания, поскольку их нельзя переопределять, а все
   виртуальные методы разрешаются при помощи динамического связывания.
5. В случае статического связывания используются не конкретные объекты, а
   информация о типе, то есть для обнаружения нужного метода используется тип
   ссылочной переменной. С другой стороны, при динамическом связывании для
   нахождения нужного метода в Java используется конкретный объект.

## Переопределение методов

Способность Java делать выбор метода, исходя из типа объекта во время
выполнения, называется «поздним связыванием». При вызове метода его поиск
происходит сначала в данном классе, затем в суперклассе, пока метод не будет
найден или не достигнут Object — суперкласс для всех классов.

Если два метода с одинаковыми именами и возвращаемыми значениями находятся в
одном классе, то списки их параметров должны отличаться. То же относится к
методам, наследуемым из суперкласса. Такие методы являются**перегружаемыми** (
overloading). При обращении вызывается доступный метод, список параметров
которого совпадает со списком параметров вызова.

Если объявление метода подкласса полностью, включая параметры, совпадает с
объявлением метода суперкласса (порождающего класса), то метод подкласса
переопределяет (overriding) метод суперкласса. Переопределение методов является
основой концепции динамического связывания, реализующей полиморфизм. Когда
переопределенный метод вызывается через ссылку суперкласса, Java определяет,
какую версию метода вызвать, основываясь на типе объекта, на который имеется
ссылка. Таким образом, тип объекта определяет версию метода на этапе выполнения.
Пример реализация полиморфизма на основе динамического связывания. Так как
суперкласс содержит методы, переопределенные подклассами, то объект суперкласса
будет вызывать методы различных подклассов в зависимости от того, на объект
какого подкласса у него имеется ссылка.

## Перегрузка методов

**Перегрузка метода** - статический полиморфизм - одинаковое название, но разные
параметры и возвращаемое значение.   
**Переопределение метода** - динамический полиморфизм - одинаковые параметры.
Статические методы могут перегружаться нестатическими, и наоборот, без
ограничений.

## Переопределение статических методов

Для статических методов принципы «позднего связывания» не работают. Динамический
полиморфизм к статическим методам класса неприменим, так как обращение к
статическому атрибуту или методу осуществляется по типу ссылки, а не по типу
объекта, через который производится обращение. Версия вызываемого статического
метода всегда определяется на этапе компиляции. При использовании ссылки для
доступа к статическому члену компилятор при выборе метода учитывает тип ссылки,
а не тип объекта, ей присвоенного.

```java
class StaticDumb {
    public static void go() {
        System.out.println("go() from StaticDumb ");
    }
}

class StaticDumber extends StaticDumb {
    //@Override – compile error
    public static void go() { // similar to dynamic polymorphism
        System.out.println("go() from StaticDumber ");
    }
}

public class Code {
    public static void main(String[] args) {
        StaticDumb dumb = new StaticDumber();
        dumb.go(); // warning: static member accessed via instance reference
        StaticDumber dumber = null;
        dumber.go(); // will not NullPointerException !
    }
}
```


